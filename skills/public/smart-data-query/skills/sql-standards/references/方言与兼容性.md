# SQL 方言与兼容性规则

## 默认方言

默认 Hive/SparkSQL；仅当用户明确要求时再输出 GaussDB 版本。

## Hive 低版本兼容性（重要）

若 Hive 版本偏低/不确定，需遵守以下规则：

### 禁止的语法
1. **禁止 TRANSFORM 函数**：低版本 Hive 不支持。
   - 数组/结构体操作 → 用 `LATERAL VIEW EXPLODE`
   - 字符串提取 → 用 `regexp_extract` / `get_json_object`

2. **禁止 SELECT/JOIN ON 中的子查询表达式**：低版本 Hive 常报 `Unsupported SubQuery Expression`。
   - 改写为 `JOIN` / 派生表 / CTE

3. **禁止 ORDER BY 序号**：不要使用 `ORDER BY 1, 2, 3`。

### ORDER BY 规则
- `ORDER BY` 必须只引用"当前 SELECT 的输出列名"
- 如果输出用了中文别名，就必须用中文别名排序，不要写底层字段名

### 示例

```sql
-- 错误：ORDER BY 用底层字段名
SELECT province_name AS `省份`, COUNT(*) AS `数量`
FROM t
GROUP BY province_name
ORDER BY province_name  -- 错误！

-- 正确：ORDER BY 用输出列别名
SELECT province_name AS `省份`, COUNT(*) AS `数量`
FROM t
GROUP BY province_name
ORDER BY `省份`  -- 正确
```

## GaussDB 差异

仅当用户明确要求时输出 GaussDB 版本，需注意：
- 日期函数差异
- 分区写法差异
- 引用符号差异（双引号 vs 反引号）

输出 GaussDB 版本时，明确"需用户在目标引擎做一次试跑确认"。

## 中文别名

- 业务验收优先用中文字段名
- Hive/SparkSQL 推荐用反引号包裹中文列名：`` `省份名称` ``
